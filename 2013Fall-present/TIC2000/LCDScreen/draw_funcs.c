/*
 * draw_funcs.c
 *
 *  Created on: Jun 22, 2014
 *      Author: Alex
 */
#include "draw_funcs.h"

// Bitmaps for the numbers from 0-9 in the font Helvetica
// 1 byte per pixel, each frame is 24x32

const unsigned char Helvetica_0 [] = {
		0x00, 0x00, 0x00, 0x00, 0x7E, 0x00, 0x01, 0xFF, 0x80, 0x03, 0xFF, 0xC0, 0x07, 0xC3, 0xE0, 0x0F,
		0x80, 0xF0, 0x0F, 0x00, 0xF0, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1C, 0x00,
		0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C,
		0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C,
		0x00, 0x38, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x0F, 0x00, 0xF0, 0x0F, 0x01,
		0xF0, 0x07, 0xC3, 0xE0, 0x03, 0xFF, 0xC0, 0x01, 0xFF, 0x80, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_1 [] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x07, 0x00, 0x00, 0x0F, 0x00, 0x00,
		0x0F, 0x00, 0x00, 0x1F, 0x00, 0x00, 0xFF, 0x00, 0x07, 0xFF, 0x00, 0x07, 0xFF, 0x00, 0x07, 0xFF,
		0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00,
		0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00,
		0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F,
		0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_2 [] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x01, 0xFF, 0xC0, 0x03, 0xFF, 0xF0, 0x07,
		0xC1, 0xF0, 0x0F, 0x80, 0x78, 0x0F, 0x00, 0x78, 0x1F, 0x00, 0x3C, 0x1E, 0x00, 0x3C, 0x1E, 0x00,
		0x3C, 0x1E, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x7C, 0x00, 0x00, 0xF8, 0x00, 0x01, 0xF0,
		0x00, 0x03, 0xF0, 0x00, 0x0F, 0xE0, 0x00, 0x1F, 0x80, 0x00, 0x7F, 0x00, 0x00, 0xFC, 0x00, 0x03,
		0xF0, 0x00, 0x07, 0xE0, 0x00, 0x07, 0x80, 0x00, 0x0F, 0x00, 0x00, 0x1E, 0x00, 0x00, 0x1E, 0x00,
		0x00, 0x1C, 0x00, 0x00, 0x3F, 0xFF, 0xFC, 0x3F, 0xFF, 0xFC, 0x3F, 0xFF, 0xFC, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_3 [] = {
		0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x01, 0xFF, 0xC0, 0x07, 0xFF, 0xE0, 0x07, 0xC1, 0xF0, 0x0F,
		0x80, 0xF0, 0x0F, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00,
		0x78, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF0, 0x00, 0x03, 0xE0, 0x00, 0x3F, 0xC0, 0x00, 0x3F, 0xC0,
		0x00, 0x3F, 0xF0, 0x00, 0x01, 0xF8, 0x00, 0x00, 0x78, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x3C, 0x3C,
		0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3E, 0x00, 0x3C, 0x1E, 0x00, 0x78, 0x1F, 0x00,
		0xF8, 0x0F, 0x81, 0xF0, 0x07, 0xFF, 0xE0, 0x03, 0xFF, 0xC0, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_4 [] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0, 0x00, 0x03, 0xE0, 0x00,
		0x07, 0xE0, 0x00, 0x0F, 0xE0, 0x00, 0x0F, 0xE0, 0x00, 0x1D, 0xE0, 0x00, 0x3D, 0xE0, 0x00, 0x79,
		0xE0, 0x00, 0x71, 0xE0, 0x00, 0xE1, 0xE0, 0x01, 0xE1, 0xE0, 0x03, 0xC1, 0xE0, 0x03, 0x81, 0xE0,
		0x07, 0x81, 0xE0, 0x0F, 0x01, 0xE0, 0x0E, 0x01, 0xE0, 0x1C, 0x01, 0xE0, 0x3C, 0x01, 0xE0, 0x3F,
		0xFF, 0xFE, 0x3F, 0xFF, 0xFE, 0x3F, 0xFF, 0xFE, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0, 0x00, 0x01,
		0xE0, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_5 [] = {
		0x00, 0x00, 0x00, 0x07, 0xFF, 0xF0, 0x07, 0xFF, 0xF0, 0x07, 0xFF, 0xF0, 0x07, 0x00, 0x00, 0x07,
		0x00, 0x00, 0x07, 0x00, 0x00, 0x07, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x0E, 0x00,
		0x00, 0x0E, 0x7F, 0x00, 0x0F, 0xFF, 0xC0, 0x0F, 0xFF, 0xE0, 0x0F, 0x83, 0xF0, 0x0F, 0x00, 0xF8,
		0x1E, 0x00, 0x78, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00,
		0x00, 0x3C, 0x00, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x78, 0x3E, 0x00, 0x78, 0x1F, 0x00,
		0xF0, 0x0F, 0x83, 0xF0, 0x0F, 0xFF, 0xE0, 0x03, 0xFF, 0xC0, 0x00, 0xFE, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_6 [] = {
		0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x01, 0xFF, 0xC0, 0x03, 0xFF, 0xE0, 0x07, 0xC1, 0xF0, 0x07,
		0x80, 0xF0, 0x0F, 0x00, 0xF8, 0x0F, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x00, 0x1E, 0x00,
		0x00, 0x3C, 0x00, 0x00, 0x3C, 0x3F, 0x00, 0x3C, 0xFF, 0xC0, 0x3D, 0xFF, 0xF0, 0x3F, 0x81, 0xF0,
		0x3F, 0x00, 0xF8, 0x3E, 0x00, 0x78, 0x3C, 0x00, 0x7C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C,
		0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x1C, 0x00, 0x3C, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x0F, 0x00,
		0xF8, 0x07, 0xC1, 0xF0, 0x03, 0xFF, 0xE0, 0x01, 0xFF, 0xC0, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_7 [] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xFF, 0xFC, 0x3F, 0xFF, 0xFC, 0x3F, 0xFF, 0xFC, 0x00,
		0x00, 0x78, 0x00, 0x00, 0x78, 0x00, 0x00, 0xF0, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0, 0x00, 0x03,
		0xC0, 0x00, 0x07, 0x80, 0x00, 0x07, 0x80, 0x00, 0x0F, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x1E, 0x00,
		0x00, 0x1E, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x78, 0x00, 0x00, 0x78, 0x00, 0x00,
		0x70, 0x00, 0x00, 0xF0, 0x00, 0x00, 0xF0, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0, 0x00, 0x01, 0xE0,
		0x00, 0x01, 0xE0, 0x00, 0x03, 0xE0, 0x00, 0x03, 0xC0, 0x00, 0x03, 0xC0, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_8 [] = {
		0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x03, 0xFF, 0xC0, 0x07, 0xFF, 0xE0, 0x0F, 0x81, 0xF0, 0x0F,
		0x00, 0xF0, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00,
		0xF8, 0x0F, 0x00, 0xF0, 0x0F, 0xC3, 0xF0, 0x03, 0xFF, 0xC0, 0x01, 0xFF, 0xC0, 0x07, 0xFF, 0xE0,
		0x0F, 0x81, 0xF0, 0x1F, 0x00, 0xF8, 0x1E, 0x00, 0x78, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C,
		0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x1E, 0x00, 0x78, 0x1F, 0x00,
		0xF8, 0x0F, 0x81, 0xF0, 0x07, 0xFF, 0xE0, 0x03, 0xFF, 0xC0, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00
};

const unsigned char Helvetica_9 [] = {
		0x00, 0x00, 0x00, 0x00, 0xFE, 0x00, 0x03, 0xFF, 0x80, 0x07, 0xFF, 0xE0, 0x0F, 0x81, 0xE0, 0x1F,
		0x00, 0xF0, 0x1E, 0x00, 0x78, 0x3E, 0x00, 0x38, 0x3C, 0x00, 0x38, 0x3C, 0x00, 0x3C, 0x3C, 0x00,
		0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x3C, 0x00, 0x3C, 0x1E, 0x00, 0x7C, 0x1F, 0x00, 0xFC,
		0x0F, 0x81, 0xFC, 0x07, 0xFF, 0xBC, 0x03, 0xFF, 0x3C, 0x00, 0xFC, 0x3C, 0x00, 0x00, 0x78, 0x00,
		0x00, 0x78, 0x00, 0x00, 0x78, 0x1E, 0x00, 0x78, 0x1E, 0x00, 0xF0, 0x1F, 0x00, 0xF0, 0x0F, 0x01,
		0xE0, 0x0F, 0x83, 0xE0, 0x07, 0xFF, 0xC0, 0x03, 0xFF, 0x80, 0x00, 0xFE, 0x00, 0x00, 0x00, 0x00
};

// Right arrow
const unsigned char arrow_r [] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x78, 0x00, 0x00, 0x3C, 0x00, 0x00,
		0x1C, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x07, 0x00, 0x3F, 0xFF, 0x80, 0x3F, 0xFF, 0xC0, 0x3F, 0xFF,
		0xC0, 0x3F, 0xFF, 0x80, 0x00, 0x07, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x1E, 0x00, 0x00, 0x3C, 0x00,
		0x00, 0x78, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


/**
 * \brief Draw a bitmapped 24x32 pixel number at the specified position. The background will be cleared first.
 */
void LCD_Helvetica24x32Bitmap(char xpos, char ypos, char number) {
	char x, y;
	const unsigned char* bitmap;
	unsigned char bt, px;
	//LCD_eraseBox(xpos, ypos, xpos+24, ypos+36);
	switch (number) {
	case 0: bitmap = Helvetica_0; break;
	case 1: bitmap = Helvetica_1; break;
	case 2: bitmap = Helvetica_2; break;
	case 3: bitmap = Helvetica_3; break;
	case 4: bitmap = Helvetica_4; break;
	case 5: bitmap = Helvetica_5; break;
	case 6: bitmap = Helvetica_6; break;
	case 7: bitmap = Helvetica_7; break;
	case 8: bitmap = Helvetica_8; break;
	case 9: bitmap = Helvetica_9; break;
	default: return;
	}
	DELAY_US(1e4);
	for (y=0; y<32; y++) {
		for (x=0; x<24; x++) {
			bt = *(bitmap + ((Uint16)y*24 + (Uint16)x)/8);
			px = bt & ((unsigned char)128>>(x%8));
			LCD_setPixel(xpos + x, ypos + y, px!=0);
		}
	}
}

/**
 * \brief Draw a 20x20 arrow bitmap, isRight=1 -> right arrow, otherwise left.
 */
void LCD_BlinkerArrowBitmap(char xpos, char ypos, char isRight) {
	char x, y;
	unsigned char bt, px;
	DELAY_US(1e4);
	for (y=0; y<20; y++) {
		for (x=0; x<20; x++) {
			bt = *(arrow_r + ((Uint16)y*3*8 + (Uint16)x)/8);
			px = bt & ((unsigned char)128>>x%8);
			if (isRight) LCD_setPixel(xpos + x, ypos + y, px==0); // Invert colors.
			else LCD_setPixel(xpos + 19 - x, ypos + y, px==0);
		}
	}
}

void LCD_barGraphH(int xStart, int yStart, int height, int width, double percent, char rewrite){
	int fillWidth, yHeight, xWidth;
	double percentVal;
	yHeight = yStart + height;
	xWidth = xStart + width;
	percentVal = percent/100;
	fillWidth = width * percentVal;
	if(rewrite == 1){
		LCD_eraseBox(xStart + 1, yStart+1, xWidth - 1, yHeight - 1);
	}
	LCD_drawBox(xStart, yStart, xWidth, yHeight);
	LCD_fillBox(xStart+1, yStart+1, xStart + fillWidth, yHeight);
}

void LCD_throttleGraphV(int xStart, int yStart, int height, int width, float32 percent){
	int fillHeight, yHeight, xWidth;
	double percentVal;
	yHeight = yStart + height;
	xWidth = xStart + width;
	percentVal = percent/100;
	fillHeight = (height/2-1) * percentVal;
	LCD_eraseBox(xStart + 1, yStart+1, xWidth - 1, yHeight - 1);
	LCD_drawBox(xStart, yStart, xWidth, yHeight); // Outline box
	LCD_fillBox(xStart+1, yStart+1+height/2-fillHeight-1, xWidth-1, yStart+1+height/2-1);
	LCD_drawLine(xStart-1, yStart+height/2, xWidth+1, yStart+height/2);
}

void LCD_vertical_line_slider(int xCenter, int yStart, int height, int width, float32 percent) {
	LCD_drawLine(xCenter, yStart, xCenter, yStart + height); // Back line
	LCD_drawLine(xCenter-width/2, yStart-1, xCenter+width/2, yStart-1);
	LCD_drawLine(xCenter-width/2, yStart+height+1, xCenter+width/2, yStart+height+1);
	LCD_drawLine(xCenter-width/2+3, yStart+height/2, xCenter+width/2-3, yStart+height/2);
	LCD_fillBox(xCenter-width/2+1, yStart+(100-percent)/100.0f*height-1, xCenter+width/2-1, yStart+(100-percent)/100.0f*height+1);
}

void LCD_barGraphV(int xStart, int yStart, int height, int width, double percent, char rewrite){
	int fillHeight, yHeight, xWidth;
	double percentVal;
	yHeight = yStart + height;
	xWidth = xStart + width;
	percentVal = percent/100;
	fillHeight = height * percentVal;
	if(rewrite == 1){
		LCD_eraseBox(xStart + 1, yStart+1, xWidth - 1, yHeight - 1);
	}
	LCD_drawBox(xStart, yStart, xWidth, yHeight);
	LCD_fillBox(xStart, yHeight - fillHeight, xWidth, yHeight);
}



/////////////////////////////////
// Primitive Drawing functions //
/////////////////////////////////
void LCD_clearScreen(){
	scia_xmit(0x7C);
	scia_xmit(0x00);
	DELAY_US(50e3);
}
void LCD_toggleReverse(){
	scia_xmit(0x7C);
	scia_xmit(0x12);
}
void LCD_setBacklight(int duty){
	scia_xmit(0x7C);
	scia_xmit(0x02);
	scia_xmit(duty);
}
void LCD_demo(){
	scia_xmit(0x7C);
	scia_xmit(0x04);
}
void LCD_setX(int posX){
	scia_xmit(0x7C);
	scia_xmit(0x18);
	scia_xmit(posX);
}
void LCD_setY(int posY){
	scia_xmit(0x7C);
	scia_xmit(0x19);
	scia_xmit(posY);
}
void LCD_resetXY(){
	scia_xmit(0x7C);
	scia_xmit(0x18);
	scia_xmit(0x00);

	scia_xmit(0x7C);
	scia_xmit(0x19);
	scia_xmit(0x00);
	DELAY_US(1e4);
}
void LCD_setPixel(int x, int y, int set){
	scia_xmit(0x7C);
	scia_xmit(0x10);
	scia_xmit(x);
	scia_xmit(y);
	scia_xmit(set);
	DELAY_US(1e2);
}
void LCD_drawLine(int xStart, int yStart, int xEnd, int yEnd){
	scia_xmit(0x7C);
	scia_xmit(0x0C);
	scia_xmit(xStart);
	scia_xmit(yStart);
	scia_xmit(xEnd);
	scia_xmit(yEnd);
	scia_xmit(0x01);
	DELAY_US(1e4);
}
void LCD_drawBox(int xStart, int yStart, int xEnd, int yEnd){
	scia_xmit(0x7C);
	scia_xmit(0x0F);
	scia_xmit(xStart);
	scia_xmit(yStart);
	scia_xmit(xEnd);
	scia_xmit(yEnd);
	scia_xmit(0x01);
	DELAY_US(1e4);
}
void LCD_drawCircle(int xStart, int yStart, int radius){
	scia_xmit(0x7C);
	scia_xmit(0x03);
	scia_xmit(xStart);
	scia_xmit(yStart);
	scia_xmit(radius);
	scia_xmit(0x01);
	DELAY_US(1e4);
}
void LCD_eraseBox(int xStart, int yStart, int xEnd, int yEnd){
	scia_xmit(0x7C);
	scia_xmit(0x05);
	scia_xmit(xStart);
	scia_xmit(yStart);
	scia_xmit(xEnd);
	scia_xmit(yEnd);
	scia_xmit(0x01);
	DELAY_US(1e4);
}
/**
 * \brief Fill a box with the specified bounds, inclusive. yEnd>yStart.
 */
void LCD_fillBox(int xStart, int yStart, int xEnd, int yEnd){
	int i;
	if (yStart > yEnd) { // Flip direction
		i = yStart;
		yStart = yEnd;
		yEnd = i;
	}
	for(i = yStart; i <= yEnd; i++){
		LCD_drawLine(xStart, i, xEnd, i);
	}
}

void LCD_printText(char *text, int x, int y){
	int i;
	LCD_setX(x);
	LCD_setY(y);
	for(i = 0; text[i] != '\0'; i++){
		scia_xmit(text[i]);
	}
	DELAY_US(1e4);

}

